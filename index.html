<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro de Ocorrências Escolares</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary-color: #f8f9fa;
            --accent-color: #f1c40f;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --border-color: #dadce0;
            --text-color: #202124;
            --light-text: #5f6368;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --footer-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 60px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .logo h1 {
            font-size: 1.6rem;
            color: white;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .logo p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 3px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        main {
            padding: 30px 0;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
            color: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to top, rgba(255,255,255,0.3), transparent);
            z-index: 1;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
            position: relative;
            z-index: 2;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
        }
        
        .card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to top, rgba(255,255,255,0.8), transparent);
            z-index: 1;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 30px;
            font-size: 1.35rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }
        
        .card-body {
            padding: 30px;
            position: relative;
            z-index: 2;
        }
        
        .student-occurrences-card {
            background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
            color: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            margin-top: 25px;
            display: none;
        }
        
        .student-occurrences-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to top, rgba(255,255,255,0.3), transparent);
            z-index: 1;
        }
        
        .student-occurrences-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            z-index: 2;
        }
        
        .student-occurrences-name {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .student-occurrences-count {
            font-size: 3rem;
            font-weight: 700;
            margin: 10px 0;
            text-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }
        
        .student-occurrences-label {
            font-size: 1.1rem;
            opacity: 0.9;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 1.1rem;
        }
        
        .required::after {
            content: " *";
            color: var(--error-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5eb;
            border-radius: 10px;
            font-size: 16px;
            transition: var(--transition);
            background-color: #f8fafc;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.2);
            background-color: white;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .checkbox-group {
            margin-bottom: 20px;
        }
        
        .checkbox-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 18px;
        }
        
        .checkbox-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e1e5eb;
            transition: var(--transition);
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .checkbox-item:hover {
            background: #e8f0fe;
            border-color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .checkbox-item input {
            width: auto;
            margin-right: 12px;
            transform: scale(1.2);
        }
        
        .chart-container {
            position: relative;
            width: 50px;
            height: 50px;
            margin-right: 15px;
        }
        
        .chart-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 700;
            font-size: 14px;
            color: var(--primary-dark);
        }
        
        .actions {
            display: flex;
            gap: 18px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            margin-top: 25px;
        }
        
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0d62d9 0%, #0a4ebf 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 115, 232, 0.35);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f8f9fa 0%, #e8eaed 100%);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #e8eaed 0%, #d7d9dd 100%);
            transform: translateY(-3px);
        }
        
        .btn-lg {
            padding: 18px 35px;
            font-size: 17px;
        }
        
        footer {
            background-color: var(--footer-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 25px 0;
            text-align: center;
            color: var(--light-text);
            font-size: 15px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .footer-links a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: none;
            font-size: 17px;
            font-weight: 500;
            align-items: center;
            gap: 15px;
        }
        
        .alert-success {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.15) 0%, rgba(39, 174, 96, 0.15) 100%);
            border: 1px solid var(--success-color);
            color: #27ae60;
        }
        
        .alert-error {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.15) 0%, rgba(192, 57, 43, 0.15) 100%);
            border: 1px solid var(--error-color);
            color: #c0392b;
        }
        
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 4px solid rgba(26, 115, 232, 0.2);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .student-select-container {
            position: relative;
        }
        
        .student-select-container::after {
            content: "\f107";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--primary-color);
            font-size: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin: 35px 0 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e1e5eb;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        select option:nth-child(even) {
            background-color: #f0f5ff;
        }
        
        select option:nth-child(odd) {
            background-color: white;
        }
        
        select:focus option:checked {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-connected {
            background-color: var(--success-color);
        }
        
        .status-disconnected {
            background-color: var(--error-color);
        }
        
        .integration-status {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        @media (max-width: 992px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 20px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .checkbox-container {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">
                    <h1>Registro de Ocorrências Escolares</h1>
                    <p>Sistema integrado com Google Sheets</p>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <main>
            <div class="dashboard">
                <div>
                    <div class="alert alert-success" id="successAlert">
                        <i class="fas fa-check-circle"></i> 
                        <div>
                            <strong>Ocorrência registrada com sucesso!</strong>
                            <p>Os dados foram enviados para a planilha de ocorrências.</p>
                        </div>
                    </div>
                    
                    <div class="alert alert-error" id="errorAlert">
                        <i class="fas fa-exclamation-circle"></i> 
                        <div>
                            <strong>Erro no preenchimento do formulário</strong>
                            <p id="errorMessage">Por favor, preencha todos os campos obrigatórios e selecione pelo menos uma irregularidade.</p>
                        </div>
                    </div>
                    
                    <div class="integration-status">
                        <i class="fas fa-plug"></i>
                        <div>
                            <strong>Status de integração:</strong> 
                            <span class="status-indicator status-connected" id="statusIndicator"></span>
                            <span id="statusText">Conectado à planilha Google Sheets</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-clipboard-list"></i> Informações da Ocorrência
                        </div>
                        <div class="card-body">
                            <form id="occurrenceForm">
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="professor" class="required">Nome do professor</label>
                                            <div class="student-select-container">
                                                <select id="professor" required>
                                                    <option value="">Carregando professores...</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="occurrenceDate" class="required">Data da ocorrência</label>
                                            <input type="date" id="occurrenceDate" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="studentClass" class="required">Turma</label>
                                            <div class="student-select-container">
                                                <select id="studentClass" required>
                                                    <option value="">Selecione a turma</option>
                                                    <option value="6° ANO A MANHA">6° ANO A MANHA</option>
                                                    <option value="6° ANO B MANHA">6° ANO B MANHA</option>
                                                    <option value="6° ANO C MANHA">6° ANO C MANHA</option>
                                                    <option value="6° ANO D MANHA">6° ANO D MANHA</option>
                                                    <option value="6° ANO E TARDE">6° ANO E TARDE</option>
                                                    <option value="6° ANO F TARDE">6° ANO F TARDE</option>
                                                    <option value="7° ANO A TARDE">7° ANO A TARDE</option>
                                                    <option value="7° ANO B TARDE">7° ANO B TARDE</option>
                                                    <option value="7° ANO C TARDE">7° ANO C TARDE</option>
                                                    <option value="7° ANO D TARDE">7° ANO D TARDE</option>
                                                    <option value="7° ANO E TARDE">7° ANO E TARDE</option>
                                                    <option value="7° ANO F TARDE">7° ANO F TARDE</option>
                                                    <option value="8° ANO A TARDE">8° ANO A TARDE</option>
                                                    <option value="8° ANO B TARDE">8° ANO B TARDE</option>
                                                    <option value="8° ANO C TARDE">8° ANO C TARDE</option>
                                                    <option value="8° ANO D TARDE">8° ANO D TARDE</option>
                                                    <option value="9° ANO A TARDE">9° ANO A TARDE</option>
                                                    <option value="9° ANO B TARDE">9° ANO B TARDE</option>
                                                    <option value="9° ANO C TARDE">9° ANO C TARDE</option>
                                                    <option value="9° ANO D TARDE">9° ANO D TARDE</option>
                                                    <option value="1ª SERIE A MANHA">1ª SERIE A MANHA</option>
                                                    <option value="1ª SERIE B MANHA">1ª SERIE B MANHA</option>
                                                    <option value="1ª SERIE C MANHA">1ª SERIE C MANHA</option>
                                                    <option value="1ª SERIE D MANHA">1ª SERIE D MANHA</option>
                                                    <option value="1ª SERIE E MANHA">1ª SERIE E MANHA</option>
                                                    <option value="1ª SERIE F MANHA">1ª SERIE F MANHA</option>
                                                    <option value="1ª SERIE G TARDE">1ª SERIE G TARDE</option>
                                                    <option value="1ª SERIE H NOITE">1ª SERIE H NOITE</option>
                                                    <option value="1ª SERIE I NOITE">1ª SERIE I NOITE</option>
                                                    <option value="2ª SERIE A MANHA">2ª SERIE A MANHA</option>
                                                    <option value="2ª SERIE B MANHA">2ª SERIE B MANHA</option>
                                                    <option value="2ª SERIE C MANHA">2ª SERIE C MANHA</option>
                                                    <option value="2ª SERIE D MANHA">2ª SERIE D MANHA</option>
                                                    <option value="2ª SERIE E MANHA">2ª SERIE E MANHA</option>
                                                    <option value="2ª SERIE F NOITE">2ª SERIE F NOITE</option>
                                                    <option value="2ª SERIE G NOITE">2ª SERIE G NOITE</option>
                                                    <option value="2ª SERIE H NOITE">2ª SERIE H NOITE</option>
                                                    <option value="3ª SERIE A MANHA">3ª SERIE A MANHA</option>
                                                    <option value="3ª SERIE B MANHA">3ª SERIE B MANHA</option>
                                                    <option value="3ª SERIE C MANHA">3ª SERie C MANHA</option>
                                                    <option value="3ª SERIE D NOITE">3ª SERIE D NOITE</option>
                                                    <option value="3ª SERIE E NOITE">3ª SERIE E NOITE</option>
                                                    <option value="3ª SERIE F NOITE">3ª SERIE F NOITE</option>
                                                    <option value="4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA">4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="student" class="required">Nome do aluno</label>
                                            <div class="student-select-container">
                                                <select id="student" required disabled>
                                                    <option value="">Selecione primeiro a turma</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="section-title">
                                    <i class="fas fa-exclamation-triangle"></i> Irregularidades
                                </div>
                                
                                <div class="checkbox-group">
                                    <label>Selecione as irregularidades (pelo menos uma):</label>
                                    <div class="checkbox-container">
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Não fez a lição"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity1" name="irregularity" value="Não fez a lição">
                                            <label for="irregularity1">Não fez a lição</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Não trouxe material"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity2" name="irregularity" value="Não trouxe material">
                                            <label for="irregularity2">Não trouxe material</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Fora do lugar constantemente durante a aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity3" name="irregularity" value="Fora do lugar constantemente durante a aula">
                                            <label for="irregularity3">Fora do lugar durante a aula</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Chegou atrasado"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity4" name="irregularity" value="Chegou atrasado">
                                            <label for="irregularity4">Chegou atrasado</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Circulando no corredor durante a aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity5" name="irregularity" value="Circulando no corredor durante a aula">
                                            <label for="irregularity5">Circulando no corredor</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Uso indevido do celular durante a aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity6" name="irregularity" value="Uso indevido do celular durante a aula">
                                            <label for="irregularity6">Uso indevido do celular</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Conversando durante a aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity7" name="irregularity" value="Conversando durante a aula">
                                            <label for="irregularity7">Conversando durante a aula</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Desrespeitou o professor"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity8" name="irregularity" value="Desrespeitou o professor">
                                            <label for="irregularity8">Desrespeitou o professor</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Desrespeitou colega"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity9" name="irregularity" value="Desrespeitou colega">
                                            <label for="irregularity9">Desrespeitou colega</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Dormindo durante a aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity10" name="irregularity" value="Dormindo durante a aula">
                                            <label for="irregularity10">Dormindo durante a aula</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Não participou da aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity11" name="irregularity" value="Não participou da aula">
                                            <label for="irregularity11">Não participou da aula</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Outros"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity12" name="irregularity" value="Outros">
                                            <label for="irregularity12">Outros</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="description">Descrição detalhada (opcional)</label>
                                    <textarea id="description" placeholder="Descreva a ocorrência com mais detalhes..."></textarea>
                                </div>
                                
                                <div class="actions">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-paper-plane"></i> Registrar Ocorrência
                                    </button>
                                    <button type="button" class="btn btn-secondary btn-lg" id="clearBtn">
                                        <i class="fas fa-eraser"></i> Limpar Formulário
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="stats-card">
                        <h3><i class="fas fa-chart-bar"></i> Estatísticas Gerais</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="totalOccurrences">0</div>
                                <div class="stat-label">Ocorrências</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalStudents">0</div>
                                <div class="stat-label">Alunos</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalTeachers">0</div>
                                <div class="stat-label">Professores</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalClasses">0</div>
                                <div class="stat-label">Turmas</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="student-occurrences-card" id="studentOccurrencesCard">
                        <div class="student-occurrences-content">
                            <div class="student-occurrences-name" id="studentOccurrencesName">Nome do Aluno</div>
                            <div class="student-occurrences-count" id="studentOccurrencesCount">0</div>
                            <div class="student-occurrences-label">Ocorrências registradas</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <footer>
        <div class="footer-links">
            <a href="#"><i class="fas fa-home"></i> Início</a>
            <a href="#"><i class="fas fa-chart-line"></i> Relatórios</a>
            <a href="#"><i class="fas fa-cog"></i> Configurações</a>
            <a href="#"><i class="fas fa-question-circle"></i> Ajuda</a>
        </div>
        <p>&copy; 2024 Sistema de Registro de Ocorrências Escolares. Todos os direitos reservados.</p>
    </footer>

    <script>
        // CONFIGURAÇÃO: Substitua pela URL do seu Google Apps Script Web App
        const SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID_HERE/exec';
        
        // Elementos do DOM
        const form = document.getElementById('occurrenceForm');
        const professorSelect = document.getElementById('professor');
        const classSelect = document.getElementById('studentClass');
        const studentSelect = document.getElementById('student');
        const clearBtn = document.getElementById('clearBtn');
        const successAlert = document.getElementById('successAlert');
        const errorAlert = document.getElementById('errorAlert');
        const errorMessage = document.getElementById('errorMessage');
        const studentOccurrencesCard = document.getElementById('studentOccurrencesCard');
        const studentOccurrencesName = document.getElementById('studentOccurrencesName');
        const studentOccurrencesCount = document.getElementById('studentOccurrencesCount');
        const totalOccurrencesEl = document.getElementById('totalOccurrences');
        const totalStudentsEl = document.getElementById('totalStudents');
        const totalTeachersEl = document.getElementById('totalTeachers');
        const totalClassesEl = document.getElementById('totalClasses');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');

        // Inicialização quando a página carrega
        document.addEventListener('DOMContentLoaded', function() {
            // Preencher data atual como padrão
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('occurrenceDate').value = formattedDate;

            // Contar turmas disponíveis
            const turmasCount = document.querySelectorAll('#studentClass option').length - 1;
            totalClassesEl.textContent = turmasCount;

            // Carregar professores
            loadTeachers();

            // Inicializar gráficos com valores zero
            document.querySelectorAll('.donut-chart').forEach(canvas => {
                createDonutChart(canvas, 0);
            });

            // Simular estatísticas iniciais
            totalOccurrencesEl.textContent = Math.floor(Math.random() * 50) + 10;
            totalStudentsEl.textContent = Math.floor(Math.random() * 200) + 800;
        });

        // Armazenar gráficos
        const charts = {};

        // Função para criar gráficos de rosca
        function createDonutChart(canvas, value, maxValue = 10) {
            const ctx = canvas.getContext('2d');
            const chartKey = canvas.getAttribute('data-irregularity');

            // Destruir gráfico anterior se existir
            if (charts[chartKey]) {
                charts[chartKey].destroy();
            }

            charts[chartKey] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [value, maxValue - value],
                        backgroundColor: [
                            '#3498db', // Cor da ocorrência
                            '#e0e0e0' // Cor de fundo
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });

            // Atualizar o número de ocorrências
            const chartValue = canvas.parentElement.querySelector('.chart-value');
            chartValue.textContent = value;
        }

        // Função para atualizar todos os gráficos
        function updateAllCharts(stats) {
            const chartCanvases = document.querySelectorAll('.donut-chart');
            chartCanvases.forEach(canvas => {
                const irregularity = canvas.getAttribute('data-irregularity');
                const count = stats[irregularity] || 0;
                createDonutChart(canvas, count);
            });
        }

        // Função para fazer requisições seguras
        async function safeFetch(url, options = {}) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                const fetchOptions = {
                    ...options,
                    signal: controller.signal,
                    mode: 'cors',
                    redirect: 'follow'
                };

                const response = await fetch(url, fetchOptions);
                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const text = await response.text();
                
                // Tentar parser como JSON
                try {
                    return JSON.parse(text);
                } catch (e) {
                    console.warn('Resposta não é JSON válido:', text);
                    return {
                        status: "error",
                        message: "Resposta inválida do servidor",
                        raw: text
                    };
                }
            } catch (error) {
                console.error('Erro na requisição:', error);
                updateConnectionStatus(false);
                return {
                    status: "error",
                    message: error.message || "Erro na requisição"
                };
            }
        }

        // Função para atualizar status de conexão
        function updateConnectionStatus(connected) {
            if (connected) {
                statusIndicator.className = 'status-indicator status-connected';
                statusText.textContent = 'Conectado à planilha Google Sheets';
            } else {
                statusIndicator.className = 'status-indicator status-disconnected';
                statusText.textContent = 'Erro de conexão com a planilha';
            }
        }

        // Carregar professores
        async function loadTeachers() {
            try {
                const data = await safeFetch(`${SCRIPT_URL}?action=getTeachers`);
                
                if (data && data.status === "success" && data.teachers) {
                    professorSelect.innerHTML = '<option value="">Selecione seu nome</option>';
                    data.teachers.forEach(teacher => {
                        const option = document.createElement('option');
                        option.value = teacher;
                        option.textContent = teacher;
                        professorSelect.appendChild(option);
                    });
                    totalTeachersEl.textContent = data.teachers.length;
                    updateConnectionStatus(true);
                } else {
                    // Fallback com professores de exemplo
                    const fallbackTeachers = [
                        'Ana Silva', 'Carlos Santos', 'Maria Oliveira', 'João Pereira',
                        'Fernanda Costa', 'Roberto Lima', 'Juliana Alves', 'Pedro Rodrigues'
                    ];
                    
                    professorSelect.innerHTML = '<option value="">Selecione seu nome</option>';
                    fallbackTeachers.forEach(teacher => {
                        const option = document.createElement('option');
                        option.value = teacher;
                        option.textContent = teacher;
                        professorSelect.appendChild(option);
                    });
                    totalTeachersEl.textContent = fallbackTeachers.length;
                    updateConnectionStatus(false);
                }
            } catch (error) {
                console.error('Erro ao carregar professores:', error);
                updateConnectionStatus(false);
            }
        }

        // Carregar alunos quando uma turma for selecionada
        classSelect.addEventListener('change', async function() {
            const selectedClass = this.value;
            studentSelect.innerHTML = '<option value="">Carregando alunos...</option>';
            studentSelect.disabled = true;
            studentOccurrencesCard.style.display = 'none';

            // Resetar gráficos
            const chartCanvases = document.querySelectorAll('.donut-chart');
            chartCanvases.forEach(canvas => {
                createDonutChart(canvas, 0);
            });

            if (!selectedClass) {
                studentSelect.innerHTML = '<option value="">Selecione uma turma</option>';
                return;
            }

            try {
                const data = await safeFetch(`${SCRIPT_URL}?action=getStudents&class=${encodeURIComponent(selectedClass)}`);
                
                if (data && data.status === "success" && data.students) {
                    studentSelect.innerHTML = '<option value="">Selecione um aluno</option>';
                    data.students.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student;
                        option.textContent = student;
                        studentSelect.appendChild(option);
                    });
                    studentSelect.disabled = false;
                    updateConnectionStatus(true);
                } else {
                    // Fallback com alunos de exemplo
                    const fallbackStudents = [
                        'Aluno Exemplo 1', 'Aluno Exemplo 2', 'Aluno Exemplo 3',
                        'Aluno Exemplo 4', 'Aluno Exemplo 5'
                    ];
                    
                    studentSelect.innerHTML = '<option value="">Selecione um aluno</option>';
                    fallbackStudents.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student;
                        option.textContent = student;
                        studentSelect.appendChild(option);
                    });
                    studentSelect.disabled = false;
                    updateConnectionStatus(false);
                }
            } catch (error) {
                console.error('Erro ao carregar alunos:', error);
                studentSelect.innerHTML = '<option value="">Erro ao carregar alunos</option>';
                updateConnectionStatus(false);
            }
        });

        // Quando um aluno é selecionado
        studentSelect.addEventListener('change', async function() {
            if (this.value) {
                // Mostrar o card de ocorrências do aluno
                studentOccurrencesCard.style.display = 'block';
                studentOccurrencesName.textContent = this.value;
                studentOccurrencesCount.textContent = "Carregando...";

                try {
                    const data = await safeFetch(`${SCRIPT_URL}?action=getStudentStats&student=${encodeURIComponent(this.value)}`);
                    
                    if (data && data.status === "success") {
                        studentOccurrencesCount.textContent = data.totalOccurrences || 0;
                        // Atualizar gráficos com os dados detalhados
                        if (data.detailedStats) {
                            updateAllCharts(data.detailedStats);
                        }
                        updateConnectionStatus(true);
                    } else {
                        studentOccurrencesCount.textContent = "0";
                        console.error('Erro ao buscar estatísticas:', data?.message);
                    }
                } catch (error) {
                    studentOccurrencesCount.textContent = "0";
                    console.error('Erro ao buscar estatísticas:', error);
                }
            } else {
                studentOccurrencesCard.style.display = 'none';
                // Resetar gráficos
                const chartCanvases = document.querySelectorAll('.donut-chart');
                chartCanvases.forEach(canvas => {
                    createDonutChart(canvas, 0);
                });
            }
        });

        // Limpar formulário
        clearBtn.addEventListener('click', function() {
            form.reset();
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('occurrenceDate').value = formattedDate;
            
            studentSelect.innerHTML = '<option value="">Selecione primeiro a turma</option>';
            studentSelect.disabled = true;
            successAlert.style.display = 'none';
            errorAlert.style.display = 'none';
            studentOccurrencesCard.style.display = 'none';

            // Resetar gráficos
            const chartCanvases = document.querySelectorAll('.donut-chart');
            chartCanvases.forEach(canvas => {
                createDonutChart(canvas, 0);
            });

            // Desmarcar todos os checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        });

        // Enviar formulário
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Esconder alertas
            successAlert.style.display = 'none';
            errorAlert.style.display = 'none';

            // Coletar dados do formulário
            const professor = professorSelect.value;
            const occurrenceDate = document.getElementById('occurrenceDate').value;
            const student = studentSelect.value;
            const classInfo = classSelect.value;
            const description = document.getElementById('description').value;

            // Verificar irregularidades selecionadas
            const irregularities = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                irregularities.push(cb.value);
            });

            // Validação
            let errorMsg = "";
            if (!professor) errorMsg += "• Selecione o professor<br>";
            if (!occurrenceDate) errorMsg += "• Informe a data da ocorrência<br>";
            if (!classInfo) errorMsg += "• Selecione a turma<br>";
            if (!student) errorMsg += "• Selecione o aluno<br>";
            if (irregularities.length === 0) errorMsg += "• Selecione pelo menos uma irregularidade<br>";

            if (errorMsg) {
                errorMessage.innerHTML = `<strong>Erros encontrados:</strong><br>${errorMsg}`;
                errorAlert.style.display = 'flex';
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }

            // Mostrar loading
            const submitBtn = form.querySelector("button[type='submit']");
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="loading"></span> Enviando...';
            submitBtn.disabled = true;

            try {
                // Preparar dados para envio
                const formData = {
                    professor: professor,
                    date: occurrenceDate,
                    student: student,
                    class: classInfo,
                    irregularities: irregularities.join(', '),
                    description: description
                };

                // Enviar para o Google Apps Script
                const response = await safeFetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response && response.status === "success") {
                    // Mostrar mensagem de sucesso
                    successAlert.style.display = 'flex';
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    // Resetar formulário após sucesso
                    form.reset();
                    const today = new Date();
                    const formattedDate = today.toISOString().split('T')[0];
                    document.getElementById('occurrenceDate').value = formattedDate;
                    
                    studentSelect.innerHTML = '<option value="">Selecione primeiro a turma</option>';
                    studentSelect.disabled = true;
                    classSelect.selectedIndex = 0;
                    studentOccurrencesCard.style.display = 'none';

                    // Atualizar estatísticas gerais
                    const currentTotal = parseInt(totalOccurrencesEl.textContent);
                    totalOccurrencesEl.textContent = currentTotal + 1;

                    // Resetar gráficos
                    const chartCanvases = document.querySelectorAll('.donut-chart');
                    chartCanvases.forEach(canvas => {
                        createDonutChart(canvas, 0);
                    });

                    updateConnectionStatus(true);
                } else {
                    throw new Error(response?.message || 'Erro desconhecido ao enviar dados');
                }
            } catch (error) {
                console.error('Erro ao enviar ocorrência:', error);
                errorMessage.textContent = `Ocorreu um erro ao enviar a ocorrência: ${error.message}`;
                errorAlert.style.display = 'flex';
                window.scrollTo({ top: 0, behavior: 'smooth' });
                updateConnectionStatus(false);
            } finally {
                // Restaurar botão de envio
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
