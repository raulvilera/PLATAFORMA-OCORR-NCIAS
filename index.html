index_single_file.html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro de Ocorrências Escolares</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Variáveis CSS */
:root {
    --primary-color: #1a73e8;
    --primary-dark: #0d47a1;
    --secondary-color: #f8f9fa;
    --accent-color: #f1c40f;
    --success-color: #2ecc71;
    --error-color: #e74c3c;
    --warning-color: #f39c12;
    --border-color: #dadce0;
    --text-color: #202124;
    --light-text: #5f6368;
    --card-bg: #ffffff;
    --header-bg: #ffffff;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
    --transition: all 0.3s ease;
    --hover-bg: #f0f5ff;
    --morning-color: #3498db;
    --afternoon-color: #f39c12;
    --night-color: #9b59b6;
    --border-radius: 12px;
    --border-radius-lg: 16px;
}

/* Reset e Base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
    color: var(--text-color);
    line-height: 1.6;
    min-height: 100vh;
}

/* Loading Overlay */
.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.9);
    z-index: 10000;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

.loading-spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid var(--primary-color);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    font-size: 1.1rem;
    color: var(--primary-color);
    font-weight: 600;
}

/* Header */
header {
    background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
    padding: 20px 0;
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 100;
}

.header-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    display: flex;
    align-items: center;
    gap: 15px;
}

.logo-icon {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    width: 60px;
    height: 60px;
    border-radius: var(--border-radius);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
}

.logo-text h1 {
    font-size: 1.8rem;
    color: white;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    margin-bottom: 5px;
}

.logo-text p {
    font-size: 0.95rem;
    color: rgba(255, 255, 255, 0.9);
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.connection-status {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255, 255, 255, 0.15);
    padding: 10px 15px;
    border-radius: var(--border-radius);
    backdrop-filter: blur(10px);
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: var(--warning-color);
    animation: pulse 2s infinite;
}

.status-indicator.connected {
    background-color: var(--success-color);
    animation: none;
}

.status-indicator.disconnected {
    background-color: var(--error-color);
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

#statusMessage {
    color: white;
    font-weight: 500;
    font-size: 0.9rem;
}

/* Container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 30px 20px;
}

/* Cards */
.card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow);
    margin-bottom: 30px;
    border: 1px solid var(--border-color);
    transition: var(--transition);
    overflow: hidden;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

.card-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 20px 30px;
    font-size: 1.3rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-body {
    padding: 30px;
}

/* Formulário */
.form-row {
    display: flex;
    gap: 25px;
    margin-bottom: 25px;
}

.form-col {
    flex: 1;
}

.form-group {
    margin-bottom: 25px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-color);
    font-size: 1rem;
    transition: var(--transition);
}

.required::after {
    content: " *";
    color: var(--error-color);
}

input, select, textarea {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e1e5eb;
    border-radius: var(--border-radius);
    font-size: 16px;
    transition: var(--transition);
    background-color: #f8fafc;
    font-family: inherit;
}

input:hover, select:hover, textarea:hover {
    border-color: var(--primary-color);
    background-color: var(--hover-bg);
    transform: translateY(-1px);
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
    background-color: white;
    transform: translateY(-1px);
}

input:disabled, select:disabled {
    background-color: #f5f5f5;
    color: #999;
    cursor: not-allowed;
}

textarea {
    min-height: 120px;
    resize: vertical;
}

/* Checkboxes */
.checkbox-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.checkbox-item {
    background: #f8fafc;
    padding: 15px;
    border-radius: var(--border-radius);
    border: 2px solid #e1e5eb;
    transition: var(--transition);
    display: flex;
    align-items: center;
    cursor: pointer;
}

.checkbox-item:hover {
    background: var(--hover-bg);
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.checkbox-item input[type="checkbox"] {
    width: auto;
    margin-right: 12px;
    transform: scale(1.2);
    cursor: pointer;
}

.checkbox-item label {
    margin-bottom: 0;
    cursor: pointer;
    font-weight: 500;
}

/* Botões */
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: var(--border-radius);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-decoration: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #0d62d9 0%, #0a4ebf 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(26, 115, 232, 0.3);
}

.btn-secondary {
    background: linear-gradient(135deg, #f8f9fa 0%, #e8eaed 100%);
    color: var(--text-color);
    border: 2px solid var(--border-color);
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #e8eaed 0%, #d7d9dd 100%);
    transform: translateY(-2px);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

/* Cards de Informação */
.info-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.info-card {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    border-radius: var(--border-radius-lg);
    padding: 25px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 20px;
    transition: var(--transition);
}

.info-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-hover);
}

.student-occurrences-card {
    background: linear-gradient(135deg, var(--warning-color) 0%, #e67e22 100%);
}

.class-total-card {
    background: linear-gradient(135deg, var(--success-color) 0%, #27ae60 100%);
}

.card-icon {
    font-size: 2.5rem;
    opacity: 0.9;
}

.card-content h3 {
    font-size: 1.1rem;
    margin-bottom: 10px;
    opacity: 0.9;
}

.card-value {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.card-label {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Dashboard */
.dashboard {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.stats-card {
    background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
    color: white;
    border-radius: var(--border-radius-lg);
    padding: 30px;
    box-shadow: var(--shadow);
}

.stats-card h2 {
    margin-bottom: 25px;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    gap: 12px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-item {
    background: rgba(255, 255, 255, 0.15);
    border-radius: var(--border-radius);
    padding: 20px;
    text-align: center;
    backdrop-filter: blur(10px);
    transition: var(--transition);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.stat-item:hover {
    transform: translateY(-3px);
    background: rgba(255, 255, 255, 0.25);
}

.stat-icon {
    font-size: 2rem;
    opacity: 0.8;
}

.stat-content {
    text-align: center;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.period-stats {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding-top: 20px;
}

.period-item {
    flex: 1;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    transition: var(--transition);
}

.period-item:hover {
    transform: scale(1.05);
}

.period-icon {
    font-size: 1.5rem;
    opacity: 0.8;
}

.period-value {
    font-size: 1.5rem;
    font-weight: 700;
}

.period-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.chart-card {
    background: var(--card-bg);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow);
    overflow: hidden;
}

.chart-container {
    padding: 20px;
    height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Tabela */
.table-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    gap: 20px;
    flex-wrap: wrap;
}

.search-box {
    position: relative;
    flex: 1;
    min-width: 250px;
}

.search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--light-text);
}

.search-box input {
    padding-left: 45px;
    margin-bottom: 0;
}

.filter-controls {
    display: flex;
    gap: 15px;
    align-items: center;
}

.filter-controls select {
    min-width: 200px;
    margin-bottom: 0;
}

.table-container {
    overflow-x: auto;
    border-radius: var(--border-radius);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.occurrences-table {
    width: 100%;
    border-collapse: collapse;
    background-color: white;
}

.occurrences-table th {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 15px;
    text-align: left;
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 10;
}

.occurrences-table td {
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-color);
}

.occurrences-table tr:hover {
    background-color: var(--hover-bg);
}

.occurrences-table tr:last-child td {
    border-bottom: none;
}

.no-records {
    text-align: center;
    padding: 40px;
    color: var(--light-text);
    background: white;
    border-radius: var(--border-radius);
}

.no-records i {
    font-size: 3rem;
    margin-bottom: 15px;
    opacity: 0.5;
}

.no-records p {
    font-size: 1.1rem;
    font-style: italic;
}

/* Toast */
.toast {
    visibility: hidden;
    min-width: 300px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: var(--border-radius);
    padding: 16px 20px;
    position: fixed;
    z-index: 1000;
    left: 50%;
    bottom: 30px;
    transform: translateX(-50%);
    font-size: 16px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

.toast.show {
    visibility: visible;
    animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

.toast.success {
    background-color: var(--success-color);
}

.toast.error {
    background-color: var(--error-color);
}

.toast.warning {
    background-color: var(--warning-color);
}

@keyframes fadein {
    from { bottom: 0; opacity: 0; }
    to { bottom: 30px; opacity: 1; }
}

@keyframes fadeout {
    from { bottom: 30px; opacity: 1; }
    to { bottom: 0; opacity: 0; }
}

/* Responsividade */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }

    .form-row {
        flex-direction: column;
    }

    .dashboard {
        grid-template-columns: 1fr;
    }

    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .period-stats {
        flex-direction: column;
        gap: 15px;
    }

    .table-controls {
        flex-direction: column;
        align-items: stretch;
    }

    .filter-controls {
        justify-content: center;
    }

    .form-actions {
        flex-direction: column;
    }

    .info-cards {
        grid-template-columns: 1fr;
    }

    .checkbox-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 20px 15px;
    }

    .card-body {
        padding: 20px;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    .logo-text h1 {
        font-size: 1.4rem;
    }

    .logo-text p {
        font-size: 0.8rem;
    }
}
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando...</div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <div class="logo-text">
                    <h1>Sistema de Ocorrências</h1>
                    <p>Gestão Escolar Simplificada</p>
                </div>
            </div>
            <div class="connection-status" id="connectionStatus">
                <span class="status-indicator" id="statusIndicator"></span>
                <span id="statusMessage">Verificando conexão...</span>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Formulário de Registro -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-file-alt"></i>
                    Registrar Nova Ocorrência
                </div>
                <div class="card-body">
                    <form id="occurrenceForm">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="dataOcorrencia" class="required">Data da Ocorrência:</label>
                                    <input type="date" id="dataOcorrencia" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="professor" class="required">Professor(a):</label>
                                    <select id="professor" required>
                                        <option value="">Selecione o Professor</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="turma" class="required">Turma:</label>
                                    <select id="turma" required>
                                        <option value="">Selecione a Turma</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="aluno" class="required">Aluno(a):</label>
                                    <select id="aluno" required disabled>
                                        <option value="">Primeiro selecione a turma</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="required">Irregularidades:</label>
                            <div class="checkbox-container">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade1" value="Agressão Física">
                                    <label for="irregularidade1">Agressão Física</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade2" value="Agressão Verbal">
                                    <label for="irregularidade2">Agressão Verbal</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade3" value="Indisciplina">
                                    <label for="irregularidade3">Indisciplina</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade4" value="Uso Indevido de Celular">
                                    <label for="irregularidade4">Uso Indevido de Celular</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade5" value="Dano ao Patrimônio">
                                    <label for="irregularidade5">Dano ao Patrimônio</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade6" value="Bullying">
                                    <label for="irregularidade6">Bullying</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade7" value="Atraso">
                                    <label for="irregularidade7">Atraso</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade8" value="Falta de Material">
                                    <label for="irregularidade8">Falta de Material</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade9" value="Desrespeito">
                                    <label for="irregularidade9">Desrespeito</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade10" value="Uniforme Inadequado">
                                    <label for="irregularidade10">Uniforme Inadequado</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade11" value="Evasão">
                                    <label for="irregularidade11">Evasão</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade12" value="Fraude/Cola">
                                    <label for="irregularidade12">Fraude/Cola</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade13" value="Porte de Objeto Perigoso">
                                    <label for="irregularidade13">Porte de Objeto Perigoso</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade14" value="Uso/Posse de Substância Ilícita">
                                    <label for="irregularidade14">Uso/Posse de Substância Ilícita</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="irregularidade15" value="Outros">
                                    <label for="irregularidade15">Outros</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="descricao">Descrição Detalhada:</label>
                            <textarea id="descricao" placeholder="Descreva a ocorrência em detalhes..."></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Registrar Ocorrência
                            </button>
                            <button type="button" class="btn btn-secondary" id="clearFormBtn">
                                <i class="fas fa-eraser"></i> Limpar Formulário
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Cards de Informações -->
            <div class="info-cards">
                <!-- Card de Ocorrências do Aluno -->
                <div class="info-card student-occurrences-card" id="studentOccurrencesCard" style="display: none;">
                    <div class="card-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="studentOccurrencesName">Nome do Aluno</h3>
                        <div class="card-value" id="studentOccurrencesCount">0</div>
                        <div class="card-label">Ocorrências Anteriores</div>
                    </div>
                </div>

                <!-- Card de Total de Alunos da Turma -->
                <div class="info-card class-total-card" id="classTotalCard" style="display: none;">
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="classTotalName">Nome da Turma</h3>
                        <div class="card-value" id="classTotalCount">0</div>
                        <div class="card-label">Total de Alunos</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard de Estatísticas -->
            <div class="dashboard">
                <div class="stats-card">
                    <h2><i class="fas fa-chart-bar"></i> Visão Geral</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalStudentsCount">0</div>
                                <div class="stat-label">Total de Alunos</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalOccurrencesCount">0</div>
                                <div class="stat-label">Total de Ocorrências</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="todayOccurrencesCount">0</div>
                                <div class="stat-label">Ocorrências Hoje</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="pendingOccurrencesCount">0</div>
                                <div class="stat-label">Pendentes</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="period-stats">
                        <div class="period-item morning">
                            <div class="period-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="period-content">
                                <div class="period-value" id="morningStudents">0</div>
                                <div class="period-label">Manhã</div>
                            </div>
                        </div>
                        <div class="period-item afternoon">
                            <div class="period-icon">
                                <i class="fas fa-cloud-sun"></i>
                            </div>
                            <div class="period-content">
                                <div class="period-value" id="afternoonStudents">0</div>
                                <div class="period-label">Tarde</div>
                            </div>
                        </div>
                        <div class="period-item night">
                            <div class="period-icon">
                                <i class="fas fa-moon"></i>
                            </div>
                            <div class="period-content">
                                <div class="period-value" id="nightStudents">0</div>
                                <div class="period-label">Noite</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="card-header">
                        <i class="fas fa-chart-pie"></i>
                        Distribuição por Período
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="periodChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabela de Registros -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-list-alt"></i>
                    Registros de Ocorrências
                </div>
                <div class="card-body">
                    <div class="table-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchInput" placeholder="Buscar por professor, aluno ou turma...">
                        </div>
                        <div class="filter-controls">
                            <select id="filterClass">
                                <option value="">Todas as Turmas</option>
                            </select>
                            <button class="btn btn-primary" id="refreshBtn">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="occurrences-table" id="occurrencesTable">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Professor</th>
                                    <th>Turma</th>
                                    <th>Aluno</th>
                                    <th>Irregularidades</th>
                                    <th>Descrição</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Registros de ocorrências serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                    <div class="no-records" id="noRecordsMessage" style="display: none;">
                        <i class="fas fa-clipboard"></i>
                        <p>Nenhum registro de ocorrência encontrado.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Configuração da API
const API_BASE_URL = '/api';

// Estado da aplicação
let currentData = {
    teachers: [],
    classes: [],
    students: [],
    occurrences: [],
    stats: {}
};

// Elementos DOM
const elements = {
    loadingOverlay: document.getElementById('loadingOverlay'),
    statusIndicator: document.getElementById('statusIndicator'),
    statusMessage: document.getElementById('statusMessage'),
    occurrenceForm: document.getElementById('occurrenceForm'),
    professorSelect: document.getElementById('professor'),
    turmaSelect: document.getElementById('turma'),
    alunoSelect: document.getElementById('aluno'),
    clearFormBtn: document.getElementById('clearFormBtn'),
    refreshBtn: document.getElementById('refreshBtn'),
    searchInput: document.getElementById('searchInput'),
    filterClass: document.getElementById('filterClass'),
    occurrencesTable: document.getElementById('occurrencesTable'),
    noRecordsMessage: document.getElementById('noRecordsMessage'),
    toast: document.getElementById('toast'),
    studentOccurrencesCard: document.getElementById('studentOccurrencesCard'),
    classTotalCard: document.getElementById('classTotalCard')
};

// Utilitários
const utils = {
    showLoading(message = 'Carregando...') {
        if (elements.loadingOverlay) {
            elements.loadingOverlay.style.display = 'flex';
            const loadingText = elements.loadingOverlay.querySelector('.loading-text');
            if (loadingText) loadingText.textContent = message;
        }
    },

    hideLoading() {
        if (elements.loadingOverlay) {
            elements.loadingOverlay.style.display = 'none';
        }
    },

    showToast(message, type = 'success') {
        if (elements.toast) {
            elements.toast.textContent = message;
            elements.toast.className = `toast show ${type}`;
            setTimeout(() => {
                elements.toast.className = elements.toast.className.replace('show', '');
            }, 3000);
        }
    },

    updateConnectionStatus(connected, message) {
        if (elements.statusIndicator && elements.statusMessage) {
            elements.statusIndicator.className = `status-indicator ${connected ? 'connected' : 'disconnected'}`;
            elements.statusMessage.textContent = message;
        }
    },

    formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('pt-BR');
    },

    validateForm() {
        const form = elements.occurrenceForm;
        if (!form) return false;

        let isValid = true;
        const requiredFields = form.querySelectorAll('[required]');
        
        // Validar campos obrigatórios
        requiredFields.forEach(field => {
            if (!field.value || !field.value.trim()) {
                field.style.borderColor = 'var(--error-color)';
                isValid = false;
            } else {
                field.style.borderColor = '';
            }
        });

        // Validar irregularidades
        const checkboxes = form.querySelectorAll('input[type="checkbox"]:checked');
        if (checkboxes.length === 0) {
            utils.showToast('Selecione pelo menos uma irregularidade', 'error');
            isValid = false;
        }

        return isValid;
    },

    clearForm() {
        if (elements.occurrenceForm) {
            elements.occurrenceForm.reset();
            
            // Resetar select de aluno
            if (elements.alunoSelect) {
                elements.alunoSelect.disabled = true;
                elements.alunoSelect.innerHTML = '<option value="">Primeiro selecione a turma</option>';
            }

            // Esconder cards de informação
            if (elements.studentOccurrencesCard) {
                elements.studentOccurrencesCard.style.display = 'none';
            }
            if (elements.classTotalCard) {
                elements.classTotalCard.style.display = 'none';
            }

            // Resetar estilos de validação
            const inputs = elements.occurrenceForm.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.style.borderColor = '';
            });
        }
    }
};

// API Service
const apiService = {
    async request(endpoint, options = {}) {
        try {
            const url = `${API_BASE_URL}${endpoint}`;
            const response = await fetch(url, {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            
            if (data.status === 'error') {
                throw new Error(data.message || 'Erro na API');
            }

            return data;
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    },

    async testConnection() {
        return this.request('/test');
    },

    async getTeachers() {
        return this.request('/teachers');
    },

    async getClasses() {
        return this.request('/classes');
    },

    async getStudentsByClass(turma) {
        return this.request(`/students/${encodeURIComponent(turma)}`);
    },

    async getStudentStats(aluno) {
        return this.request(`/student-stats/${encodeURIComponent(aluno)}`);
    },

    async getPeriodStats() {
        return this.request('/period-stats');
    },

    async getDashboardStats() {
        return this.request('/dashboard-stats');
    },

    async getAllOccurrences() {
        return this.request('/occurrences');
    },

    async createOccurrence(data) {
        return this.request('/occurrences', {
            method: 'POST',
            body: JSON.stringify(data)
        });
    }
};

// Carregamento de dados
const dataLoader = {
    async loadTeachers() {
        try {
            const response = await apiService.getTeachers();
            currentData.teachers = response.teachers || [];
            
            if (elements.professorSelect) {
                elements.professorSelect.innerHTML = '<option value="">Selecione o Professor</option>';
                currentData.teachers.forEach(teacher => {
                    const option = document.createElement('option');
                    option.value = teacher;
                    option.textContent = teacher;
                    elements.professorSelect.appendChild(option);
                });
            }
        } catch (error) {
            console.error('Erro ao carregar professores:', error);
            utils.showToast('Erro ao carregar lista de professores', 'error');
        }
    },

    async loadClasses() {
        try {
            const response = await apiService.getClasses();
            currentData.classes = response.classes || [];
            
            // Atualizar select de turma no formulário
            if (elements.turmaSelect) {
                elements.turmaSelect.innerHTML = '<option value="">Selecione a Turma</option>';
                currentData.classes.forEach(turma => {
                    const option = document.createElement('option');
                    option.value = turma;
                    option.textContent = turma;
                    elements.turmaSelect.appendChild(option);
                });
            }

            // Atualizar select de filtro
            if (elements.filterClass) {
                elements.filterClass.innerHTML = '<option value="">Todas as Turmas</option>';
                currentData.classes.forEach(turma => {
                    const option = document.createElement('option');
                    option.value = turma;
                    option.textContent = turma;
                    elements.filterClass.appendChild(option);
                });
            }
        } catch (error) {
            console.error('Erro ao carregar turmas:', error);
            utils.showToast('Erro ao carregar lista de turmas', 'error');
        }
    },

    async loadStudentsByClass(turma) {
        try {
            const response = await apiService.getStudentsByClass(turma);
            currentData.students = response.students || [];
            
            if (elements.alunoSelect) {
                elements.alunoSelect.innerHTML = '<option value="">Selecione o Aluno</option>';
                elements.alunoSelect.disabled = false;
                
                currentData.students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student;
                    option.textContent = student;
                    elements.alunoSelect.appendChild(option);
                });
            }

            // Mostrar card com total de alunos da turma
            this.showClassTotalCard(turma, response.total || 0);
        } catch (error) {
            console.error('Erro ao carregar alunos:', error);
            utils.showToast('Erro ao carregar lista de alunos', 'error');
        }
    },

    async loadStudentStats(aluno) {
        try {
            const response = await apiService.getStudentStats(aluno);
            this.showStudentOccurrencesCard(aluno, response.total_occurrences || 0);
        } catch (error) {
            console.error('Erro ao carregar estatísticas do aluno:', error);
        }
    },

    async loadDashboardStats() {
        try {
            const response = await apiService.getDashboardStats();
            currentData.stats = response.stats || {};
            this.updateDashboardStats();
        } catch (error) {
            console.error('Erro ao carregar estatísticas do dashboard:', error);
        }
    },

    async loadOccurrences() {
        try {
            const response = await apiService.getAllOccurrences();
            currentData.occurrences = response.occurrences || [];
            this.updateOccurrencesTable();
        } catch (error) {
            console.error('Erro ao carregar ocorrências:', error);
            utils.showToast('Erro ao carregar registros de ocorrências', 'error');
        }
    },

    showClassTotalCard(turma, total) {
        if (elements.classTotalCard) {
            const nameElement = document.getElementById('classTotalName');
            const countElement = document.getElementById('classTotalCount');
            
            if (nameElement) nameElement.textContent = turma;
            if (countElement) countElement.textContent = total;
            
            elements.classTotalCard.style.display = 'flex';
        }
    },

    showStudentOccurrencesCard(aluno, count) {
        if (elements.studentOccurrencesCard) {
            const nameElement = document.getElementById('studentOccurrencesName');
            const countElement = document.getElementById('studentOccurrencesCount');
            
            if (nameElement) nameElement.textContent = aluno;
            if (countElement) countElement.textContent = count;
            
            elements.studentOccurrencesCard.style.display = 'flex';
        }
    },

    updateDashboardStats() {
        const stats = currentData.stats;
        
        // Atualizar contadores principais
        const updateElement = (id, value) => {
            const element = document.getElementById(id);
            if (element) element.textContent = value || 0;
        };

        updateElement('totalStudentsCount', stats.total_students);
        updateElement('totalOccurrencesCount', stats.total_occurrences);
        updateElement('todayOccurrencesCount', stats.today_occurrences);
        updateElement('pendingOccurrencesCount', stats.pending_occurrences);
        updateElement('morningStudents', stats.morning_students);
        updateElement('afternoonStudents', stats.afternoon_students);
        updateElement('nightStudents', stats.night_students);

        // Atualizar gráfico
        this.updatePeriodChart();
    },

    updatePeriodChart() {
        const canvas = document.getElementById('periodChart');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        const stats = currentData.stats;

        // Destruir gráfico existente se houver
        if (window.periodChartInstance) {
            window.periodChartInstance.destroy();
        }

        window.periodChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Manhã', 'Tarde', 'Noite'],
                datasets: [{
                    data: [
                        stats.morning_students || 0,
                        stats.afternoon_students || 0,
                        stats.night_students || 0
                    ],
                    backgroundColor: [
                        '#3498db',
                        '#f39c12',
                        '#9b59b6'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    }
                }
            }
        });
    },

    updateOccurrencesTable() {
        const tbody = elements.occurrencesTable?.querySelector('tbody');
        if (!tbody) return;

        tbody.innerHTML = '';

        if (currentData.occurrences.length === 0) {
            if (elements.noRecordsMessage) {
                elements.noRecordsMessage.style.display = 'block';
            }
            return;
        }

        if (elements.noRecordsMessage) {
            elements.noRecordsMessage.style.display = 'none';
        }

        currentData.occurrences.forEach(occurrence => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${utils.formatDate(occurrence.data)}</td>
                <td>${occurrence.professor || ''}</td>
                <td>${occurrence.turma || ''}</td>
                <td>${occurrence.aluno || ''}</td>
                <td>${occurrence.irregularidades || ''}</td>
                <td>${occurrence.descricao || ''}</td>
            `;
            tbody.appendChild(row);
        });
    }
};

// Event Handlers
const eventHandlers = {
    async handleFormSubmit(event) {
        event.preventDefault();
        
        if (!utils.validateForm()) {
            return;
        }

        try {
            utils.showLoading('Registrando ocorrência...');

            // Coletar dados do formulário
            const formData = new FormData(elements.occurrenceForm);
            const irregularidades = [];
            
            // Coletar irregularidades selecionadas
            const checkboxes = elements.occurrenceForm.querySelectorAll('input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                irregularidades.push(checkbox.value);
            });

            const data = {
                data: document.getElementById('dataOcorrencia').value,
                professor: document.getElementById('professor').value,
                turma: document.getElementById('turma').value,
                aluno: document.getElementById('aluno').value,
                irregularidades: irregularidades.join(', '),
                descricao: document.getElementById('descricao').value
            };

            const response = await apiService.createOccurrence(data);
            
            utils.showToast('Ocorrência registrada com sucesso!', 'success');
            utils.clearForm();
            
            // Recarregar dados
            await dataLoader.loadOccurrences();
            await dataLoader.loadDashboardStats();

        } catch (error) {
            console.error('Erro ao registrar ocorrência:', error);
            utils.showToast('Erro ao registrar ocorrência: ' + error.message, 'error');
        } finally {
            utils.hideLoading();
        }
    },

    async handleTurmaChange(event) {
        const turma = event.target.value;
        
        if (turma) {
            utils.showLoading('Carregando alunos...');
            await dataLoader.loadStudentsByClass(turma);
            utils.hideLoading();
        } else {
            if (elements.alunoSelect) {
                elements.alunoSelect.disabled = true;
                elements.alunoSelect.innerHTML = '<option value="">Primeiro selecione a turma</option>';
            }
            if (elements.classTotalCard) {
                elements.classTotalCard.style.display = 'none';
            }
        }
    },

    async handleAlunoChange(event) {
        const aluno = event.target.value;
        
        if (aluno) {
            await dataLoader.loadStudentStats(aluno);
        } else {
            if (elements.studentOccurrencesCard) {
                elements.studentOccurrencesCard.style.display = 'none';
            }
        }
    },

    handleSearch() {
        const searchTerm = elements.searchInput?.value.toLowerCase() || '';
        const filterClass = elements.filterClass?.value || '';
        
        const filteredOccurrences = currentData.occurrences.filter(occurrence => {
            const matchesSearch = !searchTerm || 
                occurrence.professor?.toLowerCase().includes(searchTerm) ||
                occurrence.aluno?.toLowerCase().includes(searchTerm) ||
                occurrence.turma?.toLowerCase().includes(searchTerm);
            
            const matchesClass = !filterClass || occurrence.turma === filterClass;
            
            return matchesSearch && matchesClass;
        });

        // Atualizar tabela com dados filtrados
        const tbody = elements.occurrencesTable?.querySelector('tbody');
        if (tbody) {
            tbody.innerHTML = '';
            
            if (filteredOccurrences.length === 0) {
                if (elements.noRecordsMessage) {
                    elements.noRecordsMessage.style.display = 'block';
                }
                return;
            }

            if (elements.noRecordsMessage) {
                elements.noRecordsMessage.style.display = 'none';
            }

            filteredOccurrences.forEach(occurrence => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${utils.formatDate(occurrence.data)}</td>
                    <td>${occurrence.professor || ''}</td>
                    <td>${occurrence.turma || ''}</td>
                    <td>${occurrence.aluno || ''}</td>
                    <td>${occurrence.irregularidades || ''}</td>
                    <td>${occurrence.descricao || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }
    },

    async handleRefresh() {
        utils.showLoading('Atualizando dados...');
        await app.loadInitialData();
        utils.hideLoading();
        utils.showToast('Dados atualizados com sucesso!', 'success');
    }
};

// Aplicação principal
const app = {
    async init() {
        console.log('Inicializando aplicação...');
        
        // Verificar conexão
        await this.checkConnection();
        
        // Carregar dados iniciais
        await this.loadInitialData();
        
        // Configurar event listeners
        this.setupEventListeners();
        
        // Definir data atual no formulário
        this.setCurrentDate();
        
        console.log('Aplicação inicializada com sucesso!');
    },

    async checkConnection() {
        try {
            await apiService.testConnection();
            utils.updateConnectionStatus(true, 'Conectado ao servidor');
        } catch (error) {
            console.error('Erro de conexão:', error);
            utils.updateConnectionStatus(false, 'Erro de conexão');
        }
    },

    async loadInitialData() {
        try {
            utils.showLoading('Carregando dados iniciais...');
            
            await Promise.all([
                dataLoader.loadTeachers(),
                dataLoader.loadClasses(),
                dataLoader.loadDashboardStats(),
                dataLoader.loadOccurrences()
            ]);
            
        } catch (error) {
            console.error('Erro ao carregar dados iniciais:', error);
            utils.showToast('Erro ao carregar dados iniciais', 'error');
        } finally {
            utils.hideLoading();
        }
    },

    setupEventListeners() {
        // Formulário
        if (elements.occurrenceForm) {
            elements.occurrenceForm.addEventListener('submit', eventHandlers.handleFormSubmit);
        }

        // Selects
        if (elements.turmaSelect) {
            elements.turmaSelect.addEventListener('change', eventHandlers.handleTurmaChange);
        }

        if (elements.alunoSelect) {
            elements.alunoSelect.addEventListener('change', eventHandlers.handleAlunoChange);
        }

        // Botões
        if (elements.clearFormBtn) {
            elements.clearFormBtn.addEventListener('click', utils.clearForm);
        }

        if (elements.refreshBtn) {
            elements.refreshBtn.addEventListener('click', eventHandlers.handleRefresh);
        }

        // Busca e filtros
        if (elements.searchInput) {
            elements.searchInput.addEventListener('input', eventHandlers.handleSearch);
        }

        if (elements.filterClass) {
            elements.filterClass.addEventListener('change', eventHandlers.handleSearch);
        }
    },

    setCurrentDate() {
        const dateInput = document.getElementById('dataOcorrencia');
        if (dateInput) {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            dateInput.value = formattedDate;
        }
    }
};

// Inicializar aplicação quando DOM estiver carregado
document.addEventListener('DOMContentLoaded', () => {
    app.init();
});

// Exportar para uso global se necessário
window.app = app;
    </script>
</body>
</html>
